# 登录接口参数说明

## 接口地址
```
POST http://192.168.100.186:8080/admin-api/system/auth/login
```

## 请求头
```
Content-Type: application/json
tenant-id: 1  # 租户编号（根据实际情况填写）
```

## 请求参数

### 必需参数

| 参数名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| username | string | 登录账号（4-16位，只能包含数字和字母） | "admin" |
| password | string | 登录密码（4-16位） | "admin123" |
| captchaVerification | string | 验证码验证后的字符串（必须） | "PfcH6mgr8tpXuMWFjvW6YVaqrswIuwmWI5dsVZSg7sGpWtDCUbHuDEXl3cFB1+VvCC/rAkSwK8Fad52FSuncVg==" |

### 可选参数（社交登录时使用）

| 参数名 | 类型 | 说明 |
|--------|------|------|
| socialType | integer | 社交平台的类型 |
| socialCode | string | 授权码 |
| socialState | string | state |

## 验证码处理流程

登录接口需要先完成验证码验证，获取 `captchaVerification` 后才能调用登录接口。

### 步骤1：获取验证码

**接口地址：**
```
POST http://192.168.100.186:8080/admin-api/system/captcha/get
```

**请求参数：**
```json
{
  "captchaType": "blockPuzzle"  // 验证码类型：blockPuzzle(滑块) 或 clickWord(点选)
}
```

**响应示例：**
```json
{
  "repCode": "0000",
  "repData": {
    "originalImageBase64": "data:image/png;base64,...",  // 背景图片（base64）
    "jigsawImageBase64": "data:image/png;base64,...",    // 滑块图片（base64）
    "token": "3acd87a09a4f48fb9118333780e94883",          // 验证码token
    "secretKey": "xxx"                                     // 密钥（用于加密）
  }
}
```

### 步骤2：用户完成验证

用户在前端完成滑块验证或点选验证。

### 步骤3：校验验证码

**接口地址：**
```
POST http://192.168.100.186:8080/admin-api/system/captcha/check
```

**请求参数（滑块验证）：**
```json
{
  "captchaType": "blockPuzzle",
  "pointJson": "{\"x\":123,\"y\":45}",  // 滑块移动的坐标
  "token": "3acd87a09a4f48fb9118333780e94883"
}
```

**请求参数（点选验证）：**
```json
{
  "captchaType": "clickWord",
  "pointJson": "1,2,3",  // 点击的坐标点
  "token": "3acd87a09a4f48fb9118333780e94883"
}
```

**响应示例：**
```json
{
  "repCode": "0000",
  "repData": {
    "result": true,
    "token": "3acd87a09a4f48fb9118333780e94883"
  }
}
```

验证成功后，前端会生成 `captchaVerification` 字符串（格式：`token + '---' + pointJson` 经过AES加密）。

### 步骤4：调用登录接口

使用步骤3获得的 `captchaVerification` 调用登录接口。

## 完整请求示例

### JSON格式请求

```json
{
  "username": "admin",
  "password": "admin123",
  "captchaVerification": "PfcH6mgr8tpXuMWFjvW6YVaqrswIuwmWI5dsVZSg7sGpWtDCUbHuDEXl3cFB1+VvCC/rAkSwK8Fad52FSuncVg=="
}
```

### cURL示例

```bash
curl -X POST "http://192.168.100.186:8080/admin-api/system/auth/login" \
  -H "Content-Type: application/json" \
  -H "tenant-id: 1" \
  -d '{
    "username": "admin",
    "password": "admin123",
    "captchaVerification": "PfcH6mgr8tpXuMWFjvW6YVaqrswIuwmWI5dsVZSg7sGpWtDCUbHuDEXl3cFB1+VvCC/rAkSwK8Fad52FSuncVg=="
  }'
```

### Python示例

```python
import requests

# 1. 获取验证码
captcha_url = "http://192.168.100.186:8080/admin-api/system/captcha/get"
captcha_response = requests.post(captcha_url, json={"captchaType": "blockPuzzle"})
captcha_data = captcha_response.json()

if captcha_data.get("repCode") == "0000":
    token = captcha_data["repData"]["token"]
    # 注意：实际使用时需要用户完成验证，这里只是示例
    # 2. 校验验证码（需要用户实际完成验证）
    check_url = "http://192.168.100.186:8080/admin-api/system/captcha/check"
    check_response = requests.post(check_url, json={
        "captchaType": "blockPuzzle",
        "pointJson": "{\"x\":123,\"y\":45}",  # 实际坐标需要用户操作获得
        "token": token
    })
    
    # 3. 登录（如果验证码校验成功，会返回captchaVerification）
    login_url = "http://192.168.100.186:8080/admin-api/system/auth/login"
    login_data = {
        "username": "admin",
        "password": "admin123",
        "captchaVerification": "..."  # 从验证码校验结果中获取
    }
    login_response = requests.post(
        login_url, 
        json=login_data,
        headers={"tenant-id": "1"}
    )
    print(login_response.json())
```

## 响应示例

### 成功响应

```json
{
  "code": 0,
  "msg": "",
  "data": {
    "userId": 1024,
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expiresTime": "2024-01-01T12:00:00"
  }
}
```

### 失败响应

```json
{
  "code": 1000,
  "msg": "账号或密码不正确",
  "data": null
}
```

## 注意事项

1. **验证码是必须的**：如果系统开启了验证码功能，`captchaVerification` 参数必须传递，不能为空字符串。

2. **验证码流程**：必须先完成验证码验证流程，获取到 `captchaVerification` 后才能调用登录接口。

3. **租户ID**：需要在请求头中传递 `tenant-id`，根据实际租户填写。

4. **账号密码格式**：
   - 账号：4-16位，只能包含数字和字母
   - 密码：4-16位

5. **验证码类型**：
   - `blockPuzzle`：滑块验证码
   - `clickWord`：点选验证码

6. **验证码有效期**：验证码token有时效性，需要在有效期内完成验证和登录。

## 在API测试平台中使用

如果要在API测试平台中测试登录接口：

1. **创建测试数据时**：
   - `username`: 填写你的账号
   - `password`: 填写你的密码
   - `captchaVerification`: 这个值需要先完成验证码验证才能获得

2. **前置接口方式**：
   - 如果登录接口需要作为前置接口，建议先手动完成一次登录，获取token后保存
   - 或者使用测试环境关闭验证码功能

3. **自动化测试**：
   - 自动化测试中处理验证码比较复杂，通常需要：
     - 使用OCR识别验证码
     - 或者使用测试账号在测试环境关闭验证码
     - 或者使用验证码打码平台

