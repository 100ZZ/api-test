# 接口测试平台

一个基于Vue3 + TypeScript + Python + MySQL的前后端分离的接口测试平台，支持上传Swagger v2/OpenAPI 3.x文件，自动解析接口，并支持单个、批量或串联执行接口测试。

## 功能特性

- 📤 **Swagger/OpenAPI文件上传**: 支持上传Swagger v2或OpenAPI 3.x格式的JSON文件，自动解析所有接口
- 🔄 **远程同步**: 支持从远程URL同步Swagger文档，无需手动下载
- 🤖 **智能数据生成**: 上传Swagger后自动为每个接口生成默认测试数据，也可手动触发生成
- 📋 **接口管理**: 展示所有接口列表，支持按方法筛选，查看接口详情
- 🌍 **环境管理**: 支持多环境配置，灵活切换测试环境
- 📝 **测试数据管理**: 为每个接口配置多组测试数据，方便复用
- 🔗 **前置接口**: 支持配置前置接口（如登录），自动提取变量并注入到后续接口
- 🔄 **变量引用**: 支持在参数中使用 `{{变量名}}` 引用前置接口提取的变量
- 🌐 **全局变量**: 支持配置全局变量，使用 `$.global.变量名` 在参数中引用
- ▶️ **单个执行**: 选择接口和测试数据，单独执行某个接口测试
- 🚀 **批量执行**: 一键批量执行所有接口的测试
- 🔗 **串联执行**: 支持创建执行链，按顺序执行多个接口，支持变量传递和断言
- ✅ **断言功能**: 支持状态码、响应体、响应头、响应时间等多种断言类型
- 📊 **执行结果**: 详细展示请求和响应信息，包括状态码、响应时间等
- 📝 **执行记录**: 保存所有执行历史，方便追溯
- 💾 **流程管理**: 支持保存和管理串联执行方案，支持导入导出

## 技术栈

### 前端
- Vue 3
- TypeScript
- Element Plus
- Vite
- Axios
- Pinia
- Vue Router

### 后端
- Python 3.8+
- FastAPI
- SQLAlchemy
- PyMySQL
- Requests

### 数据库
- MySQL 5.7+

## 项目结构

```
test-platform/
├── backend/                 # 后端项目
│   ├── main.py             # FastAPI主应用
│   ├── models.py           # 数据库模型
│   ├── schemas.py          # Pydantic模型
│   ├── database.py         # 数据库连接
│   ├── config.py           # 配置文件
│   ├── swagger_parser.py   # Swagger解析器
│   ├── executor.py         # 接口执行引擎
│   └── requirements.txt    # Python依赖
├── frontend/               # 前端项目
│   ├── src/
│   │   ├── views/         # 页面组件
│   │   ├── api/           # API接口
│   │   ├── router/        # 路由配置
│   │   ├── App.vue        # 根组件
│   │   └── main.ts        # 入口文件
│   ├── index.html
│   ├── package.json
│   └── vite.config.ts
└── database/               # 数据库脚本
    └── init.sql           # 数据库初始化脚本
```

## 快速开始

### 1. 数据库初始化

```bash
# 登录MySQL
mysql -u root -p

# 执行初始化脚本
source database/init.sql

# 或者直接执行
mysql -u root -p < database/init.sql
```

### 2. 启动后端

```bash
# 进入后端目录
cd backend

# 安装依赖
pip install -r requirements.txt

# 启动服务
python main.py
```

后端服务将在 `http://localhost:5555` 启动。

### 3. 启动前端

```bash
# 进入前端目录
cd frontend

# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

前端服务将在 `http://localhost:44321` 启动。

## 使用说明

### 1. 上传Swagger文件

#### 方式一：上传文件
1. 点击页面右上角的「上传Swagger文件」按钮
2. 选择Swagger v2或OpenAPI 3.x格式的JSON文件
3. 点击「确定上传」
4. 系统会自动解析并保存所有接口
5. 🎉 **自动生成测试数据**：系统会根据接口定义，智能生成默认测试数据

#### 方式二：从URL同步
1. 点击页面右上角的「同步Swagger」按钮
2. 输入Swagger文档的URL（如：`http://localhost:48080/v3/api-docs`）
3. 系统会自动下载并解析文档
4. 同样会自动生成测试数据

### 2. 查看接口列表

- 左侧面板展示所有已解析的接口
- 可以通过方法筛选（GET、POST等）
- 点击接口可查看详细信息

### 3. 配置测试环境

1. 在接口详情页选择「环境配置」
2. 从下拉列表中选择测试环境
3. 系统预置了开发、测试、生产三个环境
   - **开发环境**: `http://localhost:44321` (默认端口)
   - **测试环境**: `http://test.example.com`
   - **生产环境**: `https://api.example.com`
4. 可通过API自行添加更多环境

### 4. 添加测试数据

#### 方式一：自动生成（推荐）
1. 选择一个接口
2. 点击「测试数据」卡片中的「生成测试数据」按钮
3. 系统会根据接口定义自动生成合理的测试数据
4. 支持多次生成，每次都会创建新的测试数据

#### 方式二：手动添加
1. 点击「测试数据」卡片中的「添加测试数据」按钮
2. 填写测试数据名称
3. 根据接口需求填写Query参数、Path参数、请求头、请求体等
4. 保存后可在执行时选择使用

**智能数据生成规则**：
- 根据参数名称智能推断（如：email -> test@example.com，phone -> 13800138000）
- 根据参数类型生成合适的值（integer -> 随机数字，boolean -> true/false）
- 支持枚举值自动选择
- 支持嵌套对象和数组的生成

### 5. 配置前置接口（可选）

如果接口需要认证token等，可以配置前置接口：

1. 选择需要配置的接口，点击「添加测试数据」
2. 在「前置接口配置」区域：
   - 选择前置接口（如登录接口）
   - 选择前置接口的测试数据
   - 配置变量提取规则（使用JSONPath，如：`$.data.accessToken`）
3. 在接口参数中使用 `{{变量名}}` 引用提取的变量
4. 执行时系统会自动先执行前置接口，提取变量，然后注入到当前接口

**示例**：
- 前置接口响应：`{"code": 0, "data": {"accessToken": "xxx"}}`
- 提取规则：`accessToken: $.data.accessToken`
- 使用：在Header中配置 `Authorization: Bearer {{accessToken}}`

### 6. 配置全局变量（可选）

1. 在「执行配置」区域的「全局变量」部分
2. 添加变量名和变量值（支持字符串或JSON）
3. 在接口参数中使用 `$.global.变量名` 引用
4. 点击「保存变量」保存配置

### 7. 执行接口测试

#### 单个执行
1. 选择一个接口
2. 选择测试环境
3. 选择测试数据或手动输入参数
4. 点击「执行接口」按钮
5. 查看执行结果

#### 批量执行
1. 选择测试环境
2. 点击左侧列表上方的「批量执行」按钮
3. 系统将执行所有接口的测试
4. 如果接口配置了测试数据，会使用测试数据执行
5. 查看批量执行统计结果

#### 串联执行（流程）
1. 切换到「串联模式」
2. 从左侧接口列表添加接口到执行链
3. 为每个接口配置参数和断言
4. 配置全局变量（可选）
5. 点击「执行」按钮，系统会按顺序执行所有接口
6. 支持变量传递：后续接口可以使用前面接口的响应数据
7. 支持断言验证：每个接口可以配置多个断言
8. 支持失败停止：可以配置执行失败时是否停止
9. 支持保存方案：可以将执行链保存为方案，方便复用

### 8. 配置断言（串联执行）

在串联执行模式下，可以为每个接口配置断言：

1. 展开接口配置，切换到「断言」标签页
2. 添加断言规则：
   - **状态码断言**：验证响应状态码
   - **响应体断言**：使用JSONPath验证响应体字段
   - **响应头断言**：验证响应头字段
   - **响应时间断言**：验证响应时间是否在范围内
3. 配置操作符：等于、不等于、大于、小于、包含等
4. 配置期望值
5. 执行时会自动验证断言，显示通过/失败状态

### 9. 查看执行结果

执行完成后，会显示：
- 响应状态码
- 响应时间
- 请求URL
- 完整请求信息
- 响应体内容（支持JSON格式化）
- 断言结果（如果配置了断言）
- 错误信息（如果失败）

所有执行记录都会保存到数据库，可通过API查询历史记录。

### 10. 流程管理

#### 保存流程
1. 在串联模式下配置好执行链
2. 点击「保存」按钮
3. 输入流程名称和描述
4. 保存后可以在右侧「流程列表」中查看

#### 加载流程
1. 在右侧「流程列表」中点击流程名称
2. 系统会自动加载流程配置到执行链
3. 可以修改后重新保存

#### 导入/导出流程
1. 点击流程右侧的「导出」按钮，下载JSON文件
2. 点击「导入」按钮，选择JSON文件导入
3. 导入时会更新当前选中的流程（如果有）

## API文档

后端API文档可访问: `http://localhost:5555/docs`

### 主要接口

**环境管理**
- `GET /api/environments` - 获取环境列表
- `POST /api/environments` - 创建环境
- `PUT /api/environments/{id}` - 更新环境
- `DELETE /api/environments/{id}` - 删除环境

**接口管理**
- `POST /api/swagger/upload` - 上传Swagger文件（自动生成测试数据）
- `POST /api/swagger/sync` - 从远程URL同步Swagger文档
- `GET /api/apis` - 获取接口列表
- `GET /api/apis/{id}` - 获取接口详情
- `DELETE /api/apis/{id}` - 删除接口
- `DELETE /api/apis` - 清空所有接口

**测试数据管理**
- `GET /api/test-data` - 获取测试数据列表
- `POST /api/test-data` - 创建测试数据
- `POST /api/test-data/generate/{api_id}` - 🎉 **智能生成测试数据**
- `PUT /api/test-data/{id}` - 更新测试数据
- `DELETE /api/test-data/{id}` - 删除测试数据

**接口执行**
- `POST /api/execute/{api_id}` - 执行单个接口
- `POST /api/execute/batch` - 批量执行接口
- `GET /api/execution-records` - 获取执行记录
- `GET /api/execution-records/{id}` - 获取执行记录详情

**串联方案管理**
- `GET /api/chain-plans` - 获取所有串联方案
- `GET /api/chain-plans/{id}` - 获取单个串联方案
- `POST /api/chain-plans` - 创建串联方案
- `PUT /api/chain-plans/{id}` - 更新串联方案
- `DELETE /api/chain-plans/{id}` - 删除串联方案

## 数据库配置

默认配置：
- 数据库名: `test_platform`
- 用户名: `root`
- 密码: `Test@123456`
- 主机: `localhost`
- 端口: `3306`

如需修改，请编辑 `backend/config.py` 文件。

## 注意事项

1. 确保MySQL服务已启动
2. 确保数据库用户有足够的权限
3. Swagger文件支持v2或OpenAPI 3.x格式的JSON文件
4. 接口执行时会实际发送HTTP请求，请谨慎操作生产环境
5. 前置接口配置后，执行时会先执行前置接口，再执行当前接口
6. 串联执行时，变量引用格式：`{{变量名}}`（前置接口变量）或 `$.global.变量名`（全局变量）

## 已实现功能

- ✅ 支持Swagger v2和OpenAPI 3.x
- ✅ 接口断言功能（状态码、响应体、响应头、响应时间）
- ✅ 测试用例编排（串联执行）
- ✅ 前置接口功能（自动提取变量）
- ✅ 全局变量功能
- ✅ 流程管理（保存、加载、导入、导出）
- ✅ 从URL同步Swagger文档

## 开发计划

- [ ] 添加定时任务
- [ ] 支持更多认证方式
- [ ] 添加性能测试功能
- [ ] 生成测试报告
- [ ] 支持数据驱动测试

## License

MIT

